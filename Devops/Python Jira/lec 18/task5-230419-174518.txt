import paramiko
from jira import JIRA
import time

user="ahmad.hds393@gmail.com"
my_token= 'ATATT3xFfGF0sNKU9IS6a0pTWUCyYhAE4tN4Kz3bUP9Qy0qTy_u7L5H5t_yozce4gDF3sfvoITwMi9_kTzZHvXscgH8J4rKLCrrKoeoIzAVsAb8WWa7M23D3ocgW3GkZjzN8WFBMDcR8cifPW4NjVyEdwTgyfILuRmtbLvHrbRqwDI_CauE1SNM=E3B35198'
server = "https://ahmadhds393.atlassian.net"
jira = JIRA(server,basic_auth=(user,my_token))


hostname="192.168.0.109"
username="ahmad"
password="12345"
client = paramiko.SSHClient()
client.set_missing_host_key_policy(paramiko.AutoAddPolicy())
client.connect(hostname=hostname,username=username,password=password)

cmd= "free -g"
stdin , stdout, stderr = client.exec_command(cmd)

cmdout = stdout.readlines()
available_mem= cmdout[1].split()[6]

if int(available_mem) <= 1:
    print("Memory is not good")
    sum= f"Memory available {available_mem}GB and Server name is {hostname}"
    Desc = f"Hi Team, We found low memroy issue on this server {hostname}, \n {sum}"
    issue_dict = {
        'project': {'key': 'IIP'},
        'issuetype': {'name': 'Issue'},
        'description': Desc  ,
        'summary': sum ,
        'priority': {'name': 'Highest'},
    }
    new_issue = jira.create_issue(fields=issue_dict)
    time.sleep(3)
    new_issue.update(assignee={"accountId": "712020:863eb8be-d3a2-43c6-82d1-70b584884765"})
    print("Ticket has been created ")

else:
    print("Memory is good ")