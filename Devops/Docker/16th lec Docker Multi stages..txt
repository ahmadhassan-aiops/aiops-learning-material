Lecture 16 : Docker Notes



Multi stage Build


Docker file --> Production , UAT , DEV

root@abdealidodia:~/docker/lect-16# pwd
/root/docker/lect-16
root@abdealidodia:~/docker/lect-16# tree
.
├── Dockerfile
├── package.json
└── src
└── index.js

Note : npm run start and npm start command both are same.
npm start is the short form for npm run start.


vim Dockerfile
FROM node:15-alpine as prod
ARG PORT=8000
ENV PORT=$PORT
WORKDIR app
copy src src
copy package.json .
RUN npm install --only=prod
EXPOSE $PORT
CMD npm run start:prod
FROM prod as dev
RUN npm install --only=dev
CMD npm start
===============================

Before multi stages docker image creation: docker build -t my-node-app:prod .
After Multi stages docker image creation : docker build -t my-node-app:prod --target=prod .

docker build -t my-node-app:dev --target=dev .


root@abdealidodia:~/docker/lect-16# docker images | head -n 3
REPOSITORY                        TAG         IMAGE ID       CREATED              SIZE
my-node-app                       dev         0c5c5c63390d   About a minute ago   122MB
my-node-app                       prod        16df7e1615a2   2 minutes ago        119MB

Note: Size different because we are not installing nodemon directory on production side.


docker run --name my_prod -p 8000:8000 -d -v /root/docker/lect-16/src:/app/src my-node-app:prod

docker run --name my_dev -p 8001:8000 -d -v /root/docker/lect-16/src:/app/src my-node-app:dev




Note : Please download Practical phase 4 for your practice in this section , And We will upload practical phase 4 solution soon. 