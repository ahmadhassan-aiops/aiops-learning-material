Deployments ahve option of roolout and roolback which replicaset donot have. Means we can convert our application to newer version seamlessly!

OPTIONS:

1. Recreate (All existing pods shut down and then again run with updated version - downtime)
2. Rollout (One by one pods get down and up and, eventually all existing pods become shut down and thier newer version created)
3. Rollback (Due to non-compatibility we again have to get back to older version - opposite to rollout)



-----------------------------------------------

[root@client1 ahmad]# cat rolling-deploy.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: myapp-deployment
  labels:
    app: myapp
    tier: frontend
spec:
  replicas: 5
  selector:
    matchLabels:
      app: alnafi-app
  template:
    metadata:
      name: nginx-2
      labels:
        app: alnafi-app
    spec:
      containers:
      - name: nginx-container
        image: nginx


-----------------------------------------------


[root@client1 ahmad]# kubectl apply -f rolling-deploy.yaml
deployment.apps/myapp-deployment created
[root@client1 ahmad]# kubectl get po,rs,deploy
NAME                                    READY   STATUS    RESTARTS   AGE
pod/myapp-deployment-7864c9d495-5dqqx   1/1     Running   0          42s
pod/myapp-deployment-7864c9d495-cqst5   1/1     Running   0          42s
pod/myapp-deployment-7864c9d495-j2ptm   1/1     Running   0          42s
pod/myapp-deployment-7864c9d495-wn448   1/1     Running   0          42s
pod/myapp-deployment-7864c9d495-zzr6g   1/1     Running   0          42s

NAME                                          DESIRED   CURRENT   READY   AGE
replicaset.apps/myapp-deployment-7864c9d495   5         5         5       42s

NAME                               READY   UP-TO-DATE   AVAILABLE   AGE
deployment.apps/myapp-deployment   5/5     5            5           42s

-----------------------------------------------

[root@client1 ahmad]# kubectl rollout status deploy myapp-deployment
deployment "myapp-deployment" successfully rolled out
[root@client1 ahmad]#


-----------------------------------------------

[root@client1 ahmad]# kubectl rollout history deploy myapp-deployment
deployment.apps/myapp-deployment
REVISION  CHANGE-CAUSE
1         <none>


-----------------------------------------------

[root@client1 ahmad]# kubectl delete deploy myapp-deployment
deployment.apps "myapp-deployment" deleted
[root@client1 ahmad]# kubectl rollout status deploy myapp-deployment
Error from server (NotFound): deployments.apps "myapp-deployment" not found


-----------------------------------------------

kubectl apply -f rolling-deploy.yaml --record
Flag --record has been deprecated, --record will be removed in the future
deployment.apps/myapp-deployment created
[root@client1 ahmad]# kubectl rollout status deploy myapp-deployment
deployment "myapp-deployment" successfully rolled out
[root@client1 ahmad]# kubectl get po,rs,deploy
NAME                                    READY   STATUS    RESTARTS   AGE
pod/myapp-deployment-7864c9d495-427lg   1/1     Running   0          31s
pod/myapp-deployment-7864c9d495-5fwfg   1/1     Running   0          31s
pod/myapp-deployment-7864c9d495-d2jd5   1/1     Running   0          31s
pod/myapp-deployment-7864c9d495-przwd   1/1     Running   0          31s
pod/myapp-deployment-7864c9d495-zqvg2   1/1     Running   0          31s

NAME                                          DESIRED   CURRENT   READY   AGE
replicaset.apps/myapp-deployment-7864c9d495   5         5         5       31s

NAME                               READY   UP-TO-DATE   AVAILABLE   AGE
deployment.apps/myapp-deployment   5/5     5            5           31s
[root@client1 ahmad]# kubectl rollout history deploy myapp-deployment
deployment.apps/myapp-deployment
REVISION  CHANGE-CAUSE
1         kubectl apply --filename=rolling-deploy.yaml --record=true



-----------------------------------------------

kubectl describe deploy myapp-deployment
Name:                   myapp-deployment
Namespace:              default
CreationTimestamp:      Thu, 01 May 2025 07:30:42 +0500
Labels:                 app=myapp
                        tier=frontend
Annotations:            deployment.kubernetes.io/revision: 1
                        kubernetes.io/change-cause: kubectl apply --filename=rolling-deploy.yaml --record=true
Selector:               app=alnafi-app
Replicas:               5 desired | 5 updated | 5 total | 5 available | 0 unavailable
StrategyType:           RollingUpdate
MinReadySeconds:        0
RollingUpdateStrategy:  25% max unavailable, 25% max surge
Pod Template:
  Labels:  app=alnafi-app
  Containers:
   nginx-container:
    Image:         nginx
    Port:          <none>
    Host Port:     <none>
    Environment:   <none>
    Mounts:        <none>
  Volumes:         <none>
  Node-Selectors:  <none>
  Tolerations:     <none>
Conditions:
  Type           Status  Reason
  ----           ------  ------
  Available      True    MinimumReplicasAvailable
  Progressing    True    NewReplicaSetAvailable
OldReplicaSets:  <none>
NewReplicaSet:   myapp-deployment-7864c9d495 (5/5 replicas created)
Events:
  Type    Reason             Age    From                   Message
  ----    ------             ----   ----                   -------
  Normal  ScalingReplicaSet  4m21s  deployment-controller  Scaled up replica set myapp-deployment-7864c9d495 from 0 to 5
[root@client1 ahmad]#



-----------------------------------------------

kubectl edit deploy myapp-deployment --record
Flag --record has been deprecated, --record will be removed in the future
deployment.apps/myapp-deployment edited


(here i have updated the nginx image to 1.22 older version)

-----------------------------------------------

kubectl rollout status deploy myapp-deployment
Waiting for deployment "myapp-deployment" rollout to finish: 3 out of 5 new replicas have been updated...



kubectl get pods
NAME                                READY   STATUS              RESTARTS   AGE
myapp-deployment-658f5885b-4gnxn    0/1     ContainerCreating   0          2m19s
myapp-deployment-658f5885b-9jpgb    0/1     ContainerCreating   0          2m19s
myapp-deployment-658f5885b-phpr7    0/1     ContainerCreating   0          2m19s
myapp-deployment-7864c9d495-427lg   1/1     Running             0          19m
myapp-deployment-7864c9d495-d2jd5   1/1     Running             0          19m
myapp-deployment-7864c9d495-przwd   1/1     Running             0          19m
myapp-deployment-7864c9d495-zqvg2   1/1     Running             0          19m



[root@client1 ahmad]# kubectl get pods
NAME                               READY   STATUS    RESTARTS   AGE
myapp-deployment-658f5885b-4gnxn   1/1     Running   0          3m6s
myapp-deployment-658f5885b-9jpgb   1/1     Running   0          3m6s
myapp-deployment-658f5885b-mtd2t   1/1     Running   0          30s
myapp-deployment-658f5885b-phpr7   1/1     Running   0          3m6s
myapp-deployment-658f5885b-sd729   1/1     Running   0          28s


[root@client1 ahmad]# kubectl rollout status deploy myapp-deployment
deployment "myapp-deployment" successfully rolled out


-----------------------------------------------

[root@client1 ahmad]# kubectl describe deploy myapp-deployment
Name:                   myapp-deployment
Namespace:              default
CreationTimestamp:      Thu, 01 May 2025 07:30:42 +0500
Labels:                 app=myapp
                        tier=frontend
Annotations:            deployment.kubernetes.io/revision: 2
                        kubernetes.io/change-cause: kubectl edit deploy myapp-deployment --record=true
Selector:               app=alnafi-app
Replicas:               5 desired | 5 updated | 5 total | 5 available | 0 unavailable
StrategyType:           RollingUpdate
MinReadySeconds:        0
RollingUpdateStrategy:  25% max unavailable, 25% max surge
Pod Template:
  Labels:  app=alnafi-app
  Containers:
   nginx-container:
    Image:         nginx:1.22
    Port:          <none>
    Host Port:     <none>
    Environment:   <none>
    Mounts:        <none>
  Volumes:         <none>
  Node-Selectors:  <none>
  Tolerations:     <none>
Conditions:
  Type           Status  Reason
  ----           ------  ------
  Available      True    MinimumReplicasAvailable
  Progressing    True    NewReplicaSetAvailable
OldReplicaSets:  myapp-deployment-7864c9d495 (0/0 replicas created)
NewReplicaSet:   myapp-deployment-658f5885b (5/5 replicas created)
Events:
  Type    Reason             Age    From                   Message
  ----    ------             ----   ----                   -------
  Normal  ScalingReplicaSet  21m    deployment-controller  Scaled up replica set myapp-deployment-7864c9d495 from 0 to 5
  Normal  ScalingReplicaSet  4m13s  deployment-controller  Scaled up replica set myapp-deployment-658f5885b from 0 to 2
  Normal  ScalingReplicaSet  4m13s  deployment-controller  Scaled down replica set myapp-deployment-7864c9d495 from 5 to 4
  Normal  ScalingReplicaSet  4m13s  deployment-controller  Scaled up replica set myapp-deployment-658f5885b from 2 to 3
  Normal  ScalingReplicaSet  97s    deployment-controller  Scaled down replica set myapp-deployment-7864c9d495 from 4 to 3
  Normal  ScalingReplicaSet  97s    deployment-controller  Scaled up replica set myapp-deployment-658f5885b from 3 to 4
  Normal  ScalingReplicaSet  95s    deployment-controller  Scaled down replica set myapp-deployment-7864c9d495 from 3 to 2
  Normal  ScalingReplicaSet  95s    deployment-controller  Scaled up replica set myapp-deployment-658f5885b from 4 to 5
  Normal  ScalingReplicaSet  93s    deployment-controller  Scaled down replica set myapp-deployment-7864c9d495 from 2 to 1
  Normal  ScalingReplicaSet  91s    deployment-controller  Scaled down replica set myapp-deployment-7864c9d495 from 1 to 0



-----------------------------------------------

kubectl get rs
NAME                          DESIRED   CURRENT   READY   AGE
myapp-deployment-658f5885b    5         5         5       5m2s
myapp-deployment-7864c9d495   0         0         0       22m


-----------------------------------------------

 kubectl rollout history deploy myapp-deployment
deployment.apps/myapp-deployment
REVISION  CHANGE-CAUSE
1         kubectl apply --filename=rolling-deploy.yaml --record=true
2         kubectl edit deploy myapp-deployment --record=true


-----------------------------------------------

 kubectl set image deploy myapp-deployment nginx-container=nginx:1.27.5 --record
Flag --record has been deprecated, --record will be removed in the future
deployment.apps/myapp-deployment image updated
[root@client1 ahmad]# kubectl rollout status deploy myapp-deployment
Waiting for deployment "myapp-deployment" rollout to finish: 4 of 5 updated replicas are available...
deployment "myapp-deployment" successfully rolled out


-----------------------------------------------

 kubectl rollout history deploy myapp-deployment
deployment.apps/myapp-deployment
REVISION  CHANGE-CAUSE
1         kubectl apply --filename=rolling-deploy.yaml --record=true
2         kubectl edit deploy myapp-deployment --record=true
3         kubectl set image deploy myapp-deployment nginx-container=nginx:1.27.5 --record=true


-----------------------------------------------

 kubectl describe deploy myapp-deployment
Name:                   myapp-deployment
Namespace:              default
CreationTimestamp:      Thu, 01 May 2025 07:30:42 +0500
Labels:                 app=myapp
                        tier=frontend
Annotations:            deployment.kubernetes.io/revision: 3
                        kubernetes.io/change-cause: kubectl set image deploy myapp-deployment nginx-container=nginx:1.27.5 --record=true
Selector:               app=alnafi-app
Replicas:               5 desired | 5 updated | 5 total | 5 available | 0 unavailable
StrategyType:           RollingUpdate
MinReadySeconds:        0
RollingUpdateStrategy:  25% max unavailable, 25% max surge
Pod Template:
  Labels:  app=alnafi-app
  Containers:
   nginx-container:
    Image:         nginx:1.27.5
    Port:          <none>
    Host Port:     <none>
    Environment:   <none>
    Mounts:        <none>
  Volumes:         <none>
  Node-Selectors:  <none>
  Tolerations:     <none>
Conditions:
  Type           Status  Reason
  ----           ------  ------
  Available      True    MinimumReplicasAvailable
  Progressing    True    NewReplicaSetAvailable
OldReplicaSets:  myapp-deployment-7864c9d495 (0/0 replicas created), myapp-deployment-658f5885b (0/0 replicas created)
NewReplicaSet:   myapp-deployment-5cc66654f4 (5/5 replicas created)
Events:
  Type    Reason             Age                From                   Message
  ----    ------             ----               ----                   -------
  Normal  ScalingReplicaSet  26m                deployment-controller  Scaled up replica set myapp-deployment-7864c9d495 from 0 to 5
  Normal  ScalingReplicaSet  9m29s              deployment-controller  Scaled up replica set myapp-deployment-658f5885b from 0 to 2
  Normal  ScalingReplicaSet  9m29s              deployment-controller  Scaled down replica set myapp-deployment-7864c9d495 from 5 to 4
  Normal  ScalingReplicaSet  9m29s              deployment-controller  Scaled up replica set myapp-deployment-658f5885b from 2 to 3
  Normal  ScalingReplicaSet  6m53s              deployment-controller  Scaled down replica set myapp-deployment-7864c9d495 from 4 to 3
  Normal  ScalingReplicaSet  6m53s              deployment-controller  Scaled up replica set myapp-deployment-658f5885b from 3 to 4
  Normal  ScalingReplicaSet  6m51s              deployment-controller  Scaled down replica set myapp-deployment-7864c9d495 from 3 to 2
  Normal  ScalingReplicaSet  6m51s              deployment-controller  Scaled up replica set myapp-deployment-658f5885b from 4 to 5
  Normal  ScalingReplicaSet  6m49s              deployment-controller  Scaled down replica set myapp-deployment-7864c9d495 from 2 to 1
  Normal  ScalingReplicaSet  6m47s              deployment-controller  Scaled down replica set myapp-deployment-7864c9d495 from 1 to 0
  Normal  ScalingReplicaSet  40s (x9 over 49s)  deployment-controller  (combined from similar events): Scaled down replica set myapp-deployment-658f5885b from 1 to 0


-----------------------------------------------

kubectl get po,rs,deploy
NAME                                    READY   STATUS    RESTARTS   AGE
pod/myapp-deployment-5cc66654f4-59dm8   1/1     Running   0          80s
pod/myapp-deployment-5cc66654f4-72vfx   1/1     Running   0          80s
pod/myapp-deployment-5cc66654f4-bqd6w   1/1     Running   0          77s
pod/myapp-deployment-5cc66654f4-gjjv2   1/1     Running   0          75s
pod/myapp-deployment-5cc66654f4-mgqr5   1/1     Running   0          80s

NAME                                          DESIRED   CURRENT   READY   AGE
replicaset.apps/myapp-deployment-5cc66654f4   5         5         5       80s
replicaset.apps/myapp-deployment-658f5885b    0         0         0       10m
replicaset.apps/myapp-deployment-7864c9d495   0         0         0       27m

NAME                               READY   UP-TO-DATE   AVAILABLE   AGE
deployment.apps/myapp-deployment   5/5     5            5           27m



-----------------------------------------------

kubectl rollout history deploy myapp-deployment --revision=3
deployment.apps/myapp-deployment with revision #3
Pod Template:
  Labels:       app=alnafi-app
        pod-template-hash=5cc66654f4
  Annotations:  kubernetes.io/change-cause: kubectl set image deploy myapp-deployment nginx-container=nginx:1.27.5 --record=true
  Containers:
   nginx-container:
    Image:      nginx:1.27.5
    Port:       <none>
    Host Port:  <none>
    Environment:        <none>
    Mounts:     <none>
  Volumes:      <none>
  Node-Selectors:       <none>
  Tolerations:  <none>

-----------------------------------------------

kubectl set image deploy myapp-deployment nginx-container=nginx:not-available-image --record
Flag --record has been deprecated, --record will be removed in the future
deployment.apps/myapp-deployment image updated
[root@client1 ahmad]# kubectl rollout status deploy myapp-deployment
Waiting for deployment "myapp-deployment" rollout to finish: 3 out of 5 new replicas have been updated...

^Z
[4]+  Stopped                 kubectl rollout status deploy myapp-deployment
[root@client1 ahmad]# kubectl get pods
NAME                                READY   STATUS             RESTARTS   AGE
myapp-deployment-5bc9f88f96-7f49x   0/1     ImagePullBackOff   0          50s
myapp-deployment-5bc9f88f96-n5btk   0/1     ImagePullBackOff   0          50s
myapp-deployment-5bc9f88f96-q5frf   0/1     ErrImagePull       0          50s
myapp-deployment-5cc66654f4-59dm8   1/1     Running            0          4m50s
myapp-deployment-5cc66654f4-72vfx   1/1     Running            0          4m50s
myapp-deployment-5cc66654f4-gjjv2   1/1     Running            0          4m45s
myapp-deployment-5cc66654f4-mgqr5   1/1     Running            0          4m50s


					
					(Still 04 pods are running)

-----------------------------------------------

kubectl rollout history deploy myapp-deployment
deployment.apps/myapp-deployment
REVISION  CHANGE-CAUSE
1         kubectl apply --filename=rolling-deploy.yaml --record=true
2         kubectl edit deploy myapp-deployment --record=true
3         kubectl set image deploy myapp-deployment nginx-container=nginx:1.27.5 --record=true
4         kubectl set image deploy myapp-deployment nginx-container=nginx:not-available-image --record=true


-----------------------------------------------

 kubectl rollout undo deploy myapp-deployment
deployment.apps/myapp-deployment rolled back
[root@client1 ahmad]# kubectl rollout history deploy myapp-deployment
deployment.apps/myapp-deployment
REVISION  CHANGE-CAUSE
1         kubectl apply --filename=rolling-deploy.yaml --record=true
2         kubectl edit deploy myapp-deployment --record=true
4         kubectl set image deploy myapp-deployment nginx-container=nginx:not-available-image --record=true
5         kubectl set image deploy myapp-deployment nginx-container=nginx:1.27.5 --record=true


-----------------------------------------------

 kubectl get po,rs,deploy
NAME                                    READY   STATUS    RESTARTS   AGE
pod/myapp-deployment-5cc66654f4-59dm8   1/1     Running   0          8m14s
pod/myapp-deployment-5cc66654f4-5sbpb   1/1     Running   0          36s
pod/myapp-deployment-5cc66654f4-72vfx   1/1     Running   0          8m14s
pod/myapp-deployment-5cc66654f4-gjjv2   1/1     Running   0          8m9s
pod/myapp-deployment-5cc66654f4-mgqr5   1/1     Running   0          8m14s

NAME                                          DESIRED   CURRENT   READY   AGE
replicaset.apps/myapp-deployment-5bc9f88f96   0         0         0       4m14s
replicaset.apps/myapp-deployment-5cc66654f4   5         5         5       8m14s
replicaset.apps/myapp-deployment-658f5885b    0         0         0       16m
replicaset.apps/myapp-deployment-7864c9d495   0         0         0       34m

NAME                               READY   UP-TO-DATE   AVAILABLE   AGE
deployment.apps/myapp-deployment   5/5     5            5           34m

-----------------------------------------------

   (rollback to nginx.1.22 revision)

 kubectl rollout undo deploy myapp-deployment --to-revision=2
deployment.apps/myapp-deployment rolled back
[root@client1 ahmad]# kubectl rollout history deploy myapp-deployment
deployment.apps/myapp-deployment
REVISION  CHANGE-CAUSE
1         kubectl apply --filename=rolling-deploy.yaml --record=true
4         kubectl set image deploy myapp-deployment nginx-container=nginx:not-available-image --record=true
5         kubectl set image deploy myapp-deployment nginx-container=nginx:1.27.5 --record=true
6         kubectl edit deploy myapp-deployment --record=true


-----------------------------------------------

kubectl describe deploy myapp-deployment
Name:                   myapp-deployment
Namespace:              default
CreationTimestamp:      Thu, 01 May 2025 07:30:42 +0500
Labels:                 app=myapp
                        tier=frontend
Annotations:            deployment.kubernetes.io/revision: 6
                        kubernetes.io/change-cause: kubectl edit deploy myapp-deployment --record=true
Selector:               app=alnafi-app
Replicas:               5 desired | 5 updated | 5 total | 5 available | 0 unavailable
StrategyType:           RollingUpdate
MinReadySeconds:        0
RollingUpdateStrategy:  25% max unavailable, 25% max surge
Pod Template:
  Labels:  app=alnafi-app
  Containers:
   nginx-container:
    Image:         nginx:1.22
    Port:          <none>
    Host Port:     <none>
    Environment:   <none>
    Mounts:        <none>
  Volumes:         <none>
  Node-Selectors:  <none>
  Tolerations:     <none>
Conditions:
  Type           Status  Reason
  ----           ------  ------
  Available      True    MinimumReplicasAvailable
  Progressing    True    NewReplicaSetAvailable
OldReplicaSets:  myapp-deployment-7864c9d495 (0/0 replicas created), myapp-deployment-5cc66654f4 (0/0 replicas created), myapp-deployment-5bc9f88f96 (0/0 replicas created)
NewReplicaSet:   myapp-deployment-658f5885b (5/5 replicas created)
Events:
  Type    Reason             Age                 From                   Message
  ----    ------             ----                ----                   -------
  Normal  ScalingReplicaSet  37m                 deployment-controller  Scaled up replica set myapp-deployment-7864c9d495 from 0 to 5
  Normal  ScalingReplicaSet  20m                 deployment-controller  Scaled up replica set myapp-deployment-658f5885b from 0 to 2
  Normal  ScalingReplicaSet  20m                 deployment-controller  Scaled down replica set myapp-deployment-7864c9d495 from 5 to 4
  Normal  ScalingReplicaSet  20m                 deployment-controller  Scaled up replica set myapp-deployment-658f5885b from 2 to 3
  Normal  ScalingReplicaSet  17m                 deployment-controller  Scaled down replica set myapp-deployment-7864c9d495 from 4 to 3
  Normal  ScalingReplicaSet  17m                 deployment-controller  Scaled down replica set myapp-deployment-7864c9d495 from 3 to 2
  Normal  ScalingReplicaSet  17m                 deployment-controller  Scaled up replica set myapp-deployment-658f5885b from 4 to 5
  Normal  ScalingReplicaSet  17m                 deployment-controller  Scaled down replica set myapp-deployment-7864c9d495 from 2 to 1
  Normal  ScalingReplicaSet  17m                 deployment-controller  Scaled down replica set myapp-deployment-7864c9d495 from 1 to 0
  Normal  ScalingReplicaSet  53s                 deployment-controller  Scaled down replica set myapp-deployment-5cc66654f4 from 5 to 4
  Normal  ScalingReplicaSet  50s (x2 over 17m)   deployment-controller  Scaled up replica set myapp-deployment-658f5885b from 3 to 4
  Normal  ScalingReplicaSet  50s (x17 over 11m)  deployment-controller  (combined from similar events): Scaled down replica set myapp-deployment-5cc66654f4 from 4 to 3


